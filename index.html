<style>
    /* ... (bestaande CSS) ... */

    /* Forceert wit contrast achter de barcode */
    #barcode-wrapper {
        background: white;
        padding: 10px;
        border-radius: 10px;
        display: inline-block;
        transition: filter 0.3s ease;
    }

    /* Een subtiele animatie om aan te geven dat de kaart 'actief' is */
    .bright-mode {
        box-shadow: 0 0 20px 5px rgba(255, 255, 255, 0.8);
        filter: contrast(1.2) brightness(1.1);
    }
</style>

<script>
    // --- SCHERM WAKKER HOUDEN ---
    let wakeLock = null;

    async function requestWakeLock() {
        try {
            if ('wakeLock' in navigator) {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log("Scherm blijft aan!");
            }
        } catch (err) {
            console.error(`${err.name}, ${err.message}`);
        }
    }

    // --- OPTIMALISEER BARCODE WEERGAVE ---
    function findClosest() {
        if (navigator.geolocation && cards.length > 0) {
            navigator.geolocation.getCurrentPosition(async pos => {
                let closest = null, minD = Infinity;
                cards.forEach(c => {
                    if (c.lat && c.lon) {
                        const d = getDistance(pos.coords.latitude, pos.coords.longitude, c.lat, c.lon);
                        if (d < minD) { minD = d; closest = c; }
                    }
                });

                if (closest) {
                    document.getElementById('store-name').innerText = closest.name;
                    document.getElementById('main-logo-box').innerHTML = getLogoHtml(closest, 70);
                    
                    // Barcode genereren
                    JsBarcode("#barcode", closest.code, {
                        background: "#ffffff",
                        lineColor: "#000000",
                        width: 2,
                        height: 100,
                        displayValue: true
                    });

                    // Activeer 'Helderheid' effect en WakeLock
                    document.getElementById('closest-area').classList.add('bright-mode');
                    document.getElementById('distance').innerText = `Afstand: ${Math.round(minD)}m (Scanner geoptimaliseerd)`;
                    
                    // Hou scherm aan
                    requestWakeLock();
                }
            });
        }
    }

    // Zorg dat de WakeLock stopt als je de app verlaat om batterij te sparen
    document.addEventListener('visibilitychange', async () => {
        if (wakeLock !== null && document.visibilityState === 'hidden') {
            await wakeLock.release();
            wakeLock = null;
        }
    });

    // Roep de functie aan bij laden
    findClosest();
</script>
